package eventStorage

import (
	"fmt"
	"time"

	"gitlab.com/vicky2135/stories/commons/lameDB"
)

func (e *Event) Save() error {

	db, err := lameDB.GetDB()

	if err != nil {
		return fmt.Errorf("error saving Event", err)
	}

	query := insertQuery()
	insStmt, prepErr := db.Prepare(query)

	if prepErr != nil {
		return fmt.Errorf("error saving event", err)
	}

	timeNow := time.Now()

	result, execErr := insStmt.Exec(u.Email)

	if execErr != nil {
		return fmt.Errorf("error saving event", execErr)
	}

	id, insErr := result.LastInsertId()

	if insErr != nil {
		return fmt.Errorf("error saving event", insErr)
	}

	// set user object
	e.ID = id
	e.CreatedAt = timeNow
	e.UpdateAt = timeNow
	return nil
}
